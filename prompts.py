"""
作文批改系统的提示词模块
包含用于LLM批改作文的各种专业提示词模板
"""
from typing import Dict, List, Any

# 作文批改任务 Prompt
letter_correction_prompt = """
你是一名经验丰富的英语教师和英语写作专家，精通英语语法、用词、拼写和写作技巧。现有一篇英语作文需要你进行专业批改。请严格按照以下要求完成批改任务：

1. **评分（15分制）**：
   - 语法准确性：评估句子结构和语法规则应用
   - 词汇运用：评估词汇多样性、准确性和复杂度
   - 内容与连贯性：评估内容完整性、逻辑连贯性和主题发展
   
   必须给出总体评分（15分制）并详细解释评分理由。

2. **错误分析**：
   请仔细分析文章中所有错误，并按以下类别详细归类：

   A. 拼写错误：
      - 必须提供具体的错误单词或短语原文（错误文本）
      - 分析错误原因（如混淆字母、遗漏字母等）
      - 提供正确拼写
      - 提供至少2个常见相似拼写错误范例及解释

   B. 语法错误：
      - 必须提供具体的错误句子或短语原文（错误文本）
      - 详细分析语法错误类型（如时态、主谓一致、冠词使用等）
      - 提供正确语法形式
      - 解释相关语法规则，并提供至少2个正确和错误对比示例

   C. 用词不当：
      - 必须提供具体的不当用词原文（错误文本）
      - 分析为何用词不恰当（如语境不合、搭配不当、词义偏差等）
      - 提供更恰当的词汇选择
      - 列举至少2个相似上下文中的正确用词示例

   重要说明：对于每个错误，你必须：
   - 先提供错误文本的准确内容（不要只提供位置）
   - 再标记错误文本在原文中的确切位置（字符索引）
   - 进行全面、深入的错误分析
   - 给出具体可操作的修改建议

3. **亮点分析**：
   A. 高级词汇：
      - 识别所有高级词汇
      - 解释为何这些词汇优于基础词汇
      - 分析词汇的语境适用性和表达效果
      - 举例说明该词汇的其他用法

   B. 优秀表达：
      - 找出所有亮点句式和表达
      - 详细分析表达的优点（如简洁性、准确性、生动性等）
      - 解释这些表达如何提升文章质量
      - 提供类似情境下的其他优秀表达方式

4. **写作建议**：
   - 针对思路结构方面提供具体改进建议
   - 针对语言表达方面提供详细修改方向
   - 针对内容深度方面提供拓展思路
   - 提供至少3个可以立即应用的具体写作技巧和练习方法

5. **专业要求**：
   - 分析必须专业、准确、详尽
   - 指出的错误必须真实存在，不要过度挑剔
   - 建议必须具体、可操作，避免泛泛而谈
   - 使用鼓励性语言，注重正面引导

作文内容：
{essay}

输出格式（必须使用如下JSON格式，包含所有必需字段）：
{{
    "评分": {{
        "分数": "xx/15",
        "评分理由": "详细解释评分依据，至少100字"
    }},
    "错误分析": {{
        "拼写错误": [
            {{
                "错误文本": "具体的错误单词/短语原文",
                "错误位置": [start, end],
                "详细分析": "错误分析内容，至少50字",
                "正确形式": "正确拼写",
                "正例": ["至少两个相关正确例子"],
                "反例": ["至少两个相关错误例子"]
            }}
        ],
        "语法错误": [
            {{
                "错误文本": "具体的错误句子/短语原文",
                "错误位置": [start, end],
                "详细分析": "语法错误分析，至少50字",
                "正确形式": "正确语法形式",
                "语法规则": "相关语法规则解释",
                "正例": ["至少两个正确例子"],
                "反例": ["至少两个错误例子"]
            }}
        ],
        "用词不当": [
            {{
                "错误文本": "具体的不当用词/短语原文",
                "错误位置": [start, end],
                "详细分析": "用词不当分析，至少50字",
                "建议用词": "更恰当的词汇选择",
                "正例": ["至少两个正确用词例子"],
                "反例": ["至少两个不当用词例子"]
            }}
        ]
    }},
    "亮点分析": {{
        "高级词汇": [
            {{
                "词汇": "高级词汇原文",
                "位置": [start, end],
                "优秀之处": "详细说明至少30字",
                "其他用法": ["至少三个其他用法示例"]
            }}
        ],
        "亮点表达": [
            {{
                "表达": "亮点表达原文",
                "位置": [start, end],
                "优秀之处": "详细说明至少50字",
                "类似表达": ["至少三个类似优秀表达方式"]
            }}
        ]
    }},
    "写作建议": {{
        "结构建议": "具体的结构改进建议,不少于100字",
        "表达建议": "具体的语言表达建议,不少于100字",
        "内容建议": "具体的内容深度建议,不少于100字",
        "实用技巧": ["至少2个具体可操作的写作技巧"]
    }}
}}

{format_instructions}
"""

# 用于构造各种错误类型的模式定义
ERROR_PATTERNS: Dict[str, List[Dict[str, Any]]] = {
    "拼写错误": [
        {"pattern": r"\b\w+ly\b", "description": "拼写错误：副词拼写不正确"},
        {"pattern": r"\b\w+ing\b", "description": "拼写错误：动名词拼写不正确"},
        {"pattern": r"\b[a-zA-Z]{2,}[bcdfghjklmnpqrstvwxz]{2}[a-zA-Z]*\b", "description": "拼写错误：双辅音字母使用错误"},
        {"pattern": r"\b[a-zA-Z]+[aeiou]{3}[a-zA-Z]*\b", "description": "拼写错误：连续三个元音字母可能有误"}
    ],
    "语法错误": [
        {"pattern": r"\b(is|are|was|were)\s+\w+ing\b", "description": "语法错误：进行时态使用不当"},
        {"pattern": r"\b(has|have)\s+\w+ed\b", "description": "语法错误：完成时态使用不当"},
        {"pattern": r"\ba\s+[aeiou]\w+\b", "description": "语法错误：冠词a与元音开头单词搭配错误"},
        {"pattern": r"\ban\s+[^aeiou\s]\w+\b", "description": "语法错误：冠词an与辅音开头单词搭配错误"},
        {"pattern": r"\b(much|little)\s+\w+s\b", "description": "语法错误：不可数名词量词与可数名词复数形式错误搭配"}
    ],
    "用词不当": [
        {"pattern": r"\b(very|really|extremely)\s+\w+\b", "description": "用词不当：过度使用强调词"},
        {"pattern": r"\b(good|bad|nice|terrible)\b", "description": "用词不当：使用过于简单的形容词"},
        {"pattern": r"\b(big|small|large)\b", "description": "用词不当：使用过于基础的描述性词汇"},
        {"pattern": r"\b(a lot of|lots of)\b", "description": "用词不当：使用非正式数量词"},
        {"pattern": r"\b(thing|stuff|something)\b", "description": "用词不当：使用模糊不精确的名词"}
    ]
}

# 导出 Prompts，供任务模块调用
__all__ = [
    "letter_correction_prompt",
    "ERROR_PATTERNS"
]
